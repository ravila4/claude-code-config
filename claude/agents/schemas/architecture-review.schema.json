{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Architecture Review",
  "description": "Structured output from architecture-devils-advocate agent",
  "type": "object",
  "required": [
    "review_id",
    "timestamp",
    "architecture_summary",
    "critical_issues",
    "dry_orthogonality_violations",
    "alternatives",
    "risk_assessment",
    "recommendations"
  ],
  "properties": {
    "review_id": {
      "type": "string",
      "description": "Unique identifier for this review (YYYY-MM-DD-{topic}-{hash})"
    },
    "timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp when review was conducted"
    },
    "architecture_summary": {
      "type": "object",
      "description": "Brief summary of the architecture being reviewed",
      "required": ["type", "description", "components"],
      "properties": {
        "type": {
          "type": "string",
          "enum": [
            "database_schema",
            "api_design",
            "data_pipeline",
            "system_architecture",
            "module_structure",
            "other"
          ]
        },
        "description": {
          "type": "string",
          "description": "High-level description of what's being reviewed"
        },
        "components": {
          "type": "array",
          "items": {"type": "string"},
          "description": "Key components or entities in the design"
        }
      }
    },
    "critical_issues": {
      "type": "array",
      "description": "Prioritized list of architectural concerns (highest severity first)",
      "items": {
        "type": "object",
        "required": ["severity", "category", "description", "impact", "affected_components"],
        "properties": {
          "severity": {
            "type": "string",
            "enum": ["critical", "high", "medium", "low"]
          },
          "category": {
            "type": "string",
            "enum": [
              "scalability",
              "reliability",
              "maintainability",
              "performance",
              "security",
              "complexity",
              "data_consistency",
              "coupling"
            ]
          },
          "description": {
            "type": "string",
            "description": "Clear explanation of the issue"
          },
          "impact": {
            "type": "string",
            "description": "What happens if this isn't addressed"
          },
          "affected_components": {
            "type": "array",
            "items": {"type": "string"},
            "description": "Which components/modules are affected"
          }
        }
      }
    },
    "dry_orthogonality_violations": {
      "type": "array",
      "description": "Instances of repeated logic or hidden coupling",
      "items": {
        "type": "object",
        "required": ["type", "description", "locations", "impact"],
        "properties": {
          "type": {
            "type": "string",
            "enum": [
              "repeated_logic",
              "overlapping_responsibilities",
              "hidden_coupling",
              "configuration_sprawl"
            ]
          },
          "description": {
            "type": "string",
            "description": "What is being repeated or coupled"
          },
          "locations": {
            "type": "array",
            "items": {"type": "string"},
            "description": "Where the violation occurs (components/files)"
          },
          "impact": {
            "type": "string",
            "description": "Why this matters (maintenance burden, bugs, etc.)"
          }
        }
      }
    },
    "alternatives": {
      "type": "array",
      "description": "Alternative approaches to consider",
      "items": {
        "type": "object",
        "required": ["name", "description", "trade_offs", "implementation_notes"],
        "properties": {
          "name": {
            "type": "string",
            "description": "Name of the alternative approach"
          },
          "description": {
            "type": "string",
            "description": "How this approach would work"
          },
          "trade_offs": {
            "type": "object",
            "required": ["pros", "cons"],
            "properties": {
              "pros": {
                "type": "array",
                "items": {"type": "string"},
                "description": "Advantages of this approach"
              },
              "cons": {
                "type": "array",
                "items": {"type": "string"},
                "description": "Disadvantages or challenges"
              }
            }
          },
          "implementation_notes": {
            "type": "string",
            "description": "Specific considerations for implementing this alternative"
          },
          "references": {
            "type": "array",
            "items": {"type": "string"},
            "description": "Books, articles, or patterns this alternative draws from"
          }
        }
      }
    },
    "risk_assessment": {
      "type": "object",
      "description": "Potential failure modes and mitigation strategies",
      "required": ["risks"],
      "properties": {
        "risks": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["category", "description", "likelihood", "impact", "mitigation"],
            "properties": {
              "category": {
                "type": "string",
                "enum": [
                  "single_point_of_failure",
                  "scalability_bottleneck",
                  "data_consistency",
                  "operational_complexity",
                  "security_vulnerability",
                  "performance_degradation"
                ]
              },
              "description": {
                "type": "string",
                "description": "What could go wrong"
              },
              "likelihood": {
                "type": "string",
                "enum": ["high", "medium", "low"]
              },
              "impact": {
                "type": "string",
                "enum": ["critical", "high", "medium", "low"]
              },
              "mitigation": {
                "type": "string",
                "description": "How to address or prevent this risk"
              }
            }
          }
        }
      }
    },
    "recommendations": {
      "type": "array",
      "description": "Actionable next steps for improving the design (prioritized)",
      "items": {
        "type": "object",
        "required": ["priority", "action", "rationale", "effort"],
        "properties": {
          "priority": {
            "type": "integer",
            "minimum": 1,
            "description": "Priority order (1 = highest)"
          },
          "action": {
            "type": "string",
            "description": "What should be done"
          },
          "rationale": {
            "type": "string",
            "description": "Why this is important"
          },
          "effort": {
            "type": "string",
            "enum": ["high", "medium", "low"],
            "description": "Estimated effort to implement"
          }
        }
      }
    }
  }
}
